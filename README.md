# GCN_t
## Installation
### Operating System

Ubuntu 22.04

### Conda
`conda config --add channels conda-forge`

`conda config --add channels pytorch`

`conda create -n name python=3.8 pytorch scip=8.0.1 pyscipopt numpy treelib matplotlib`

`conda install cython scipy joblib mpi4py`

If you want to generate new instances, please install gurobi:

`conda install -c gurobi gurobi`

## Run
Before run the code, please compile the cython function: modify the path of `include_dirs` and `library_dirs` in `setup.py` to your own environment. Then, run the command

`python3 setup.py build_ext --inplace`

### Training

`python3 -u kan_train.py`

### Testing

`python3 -u kan_test.py`

### New Instances
To generate new instances, run `atc/datagenerateremove.py` (smaller size instances) or `atc/datageneratefixed.py` (larger size instances). In the report, we are using the smaller one (11590 variables*13000 constraints)

`python -u datagenerateremove.py`

Then, make the initial solution for new instances by using `atc/make_ini.py`

`python -u make_ini.py`

## Hierarchical structure

```bash

GCN_t:
│  baseline.py                                                // making scip baseline
│  extract.c                                                  // generated by extract.pyx and .pxd
│  extract.cpython-38-x86_64-linux-gnu.so                     // generated by extract.pyx and .pxd
│  extract.pxd                                                // customized scip api
│  extract.pyx                                                // customized scip api
│  kan_test.py                                                // testing file
│  kan_train.py                                               // training KAN
│  README.md
│  setup.py                                                   // compiling file for extract.pyx and .pxd
│  tempCodeRunnerFile.py
│  utilities.py
│  
├─atc                                                         // files to generate atc dataset
│  │  background.py                                           // background definition
│  │  backgroundfixed.py                                      // background definition without noise on position of flights
│  │  datagenerate.py                                         // generating instances (.mps files)
│  │  datageneratefixed.py                                    // generating instances without noise on position of flights
│  │  datagenerateremove.py                                   // generating instances without noise on position of flights and without not controlled variables
│  │  formula.py                                              // STL formula
│  │  linear.py                                               // linear system
│  │  make_ini.py                                             // generating initial solution
│  │  nonlinear.py                                            // non-linear system
│  │  predicate.py                                            // STL predicate
│  │  
│  ├─stlpy                                                    // files from https://github.com/vincekurtz/stlpy
│  │  │  LISENCE
│  │  │  __init__.py
│  │  │  
│  │  ├─benchmarks
│  │  │  │  base.py
│  │  │  │  common.py
│  │  │  │  door_puzzle.py
│  │  │  │  either_or.py
│  │  │  │  narrow_passage.py
│  │  │  │  nonlinear_reach_avoid.py
│  │  │  │  random_multitarget.py
│  │  │  │  reach_avoid.py
│  │  │  │  stepping_stones.py
│  │  │  │  __init__.py
│  │  │  │  
│  │  │  └─__pycache__
│  │  │          
│  │  ├─solvers
│  │  │  │  base.py
│  │  │  │  __init__.py
│  │  │  │  
│  │  │  ├─drake
│  │  │  │  │  drake_base.py
│  │  │  │  │  drake_micp.py
│  │  │  │  │  drake_smooth.py
│  │  │  │  │  drake_sos1.py
│  │  │  │  │  __init__.py
│  │  │  │  │  
│  │  │  │  └─__pycache__
│  │  │  │          
│  │  │  ├─gurobi
│  │  │  │  │  gurobi_micp.py
│  │  │  │  │  __init__.py
│  │  │  │  │  
│  │  │  │  └─__pycache__
│  │  │  │          
│  │  │  ├─scipy
│  │  │  │  │  gradient_solver.py
│  │  │  │  │  __init__.py
│  │  │  │  │  
│  │  │  │  └─__pycache__
│  │  │  │          
│  │  │  └─__pycache__
│  │  │          
│  │  ├─STL
│  │  │  │  formula.py
│  │  │  │  predicate.py
│  │  │  │  __init__.py
│  │  │  │  
│  │  │  └─__pycache__
│  │  │          
│  │  ├─systems
│  │  │  │  linear.py
│  │  │  │  nonlinear.py
│  │  │  │  __init__.py
│  │  │  │  
│  │  │  └─__pycache__
│  │  │          
│  │  └─__pycache__
│  │          
│  └─__pycache__
│          
├─build                                                       // 
│  └─lib.linux-x86_64-cpython-38
│          execute.cpython-38-x86_64-linux-gnu.so
│          
├─ddpg                                                        // files about training, modified from https://github.com/openai/spinningup
│  │  core.py                                                 // MLP actor and critic network
│  │  corekan.py                                              // KAN actor and critic network
│  │  ddpgclass.py                                            // MLP customized actor-critic algorithm
│  │  ddpgclasskan.py                                         // KAN customized actor-critic algorithm
│  │  kan.py                                                  // KAN
│  │  model.py                                                // Bipartite convolutional layer and MLP
│  │  modelkan.py                                             // Bipartite convolutional layer and KAN
│  │  noise.py                                                // noise from https://github.com/DLR-RM/stable-baselines3
│  │  user_config.py
│  │  util.py                                                 
│  │  
│  ├─utils                                                    // from https://github.com/openai/spinningup
│  │  │  logx.py
│  │  │  mpi_tools.py
│  │  │  run_utils.py
│  │  │  serialization_utils.py
│  │  │  
│  │  └─__pycache__
│  │          
│  └─__pycache__
│          
├─example_model                                               // model example in report
│  │  vars.pkl
│  │  
│  ├─pyt_save
│  │      model.pt
│  │      
│  └─test_results
│      │  
│      └─.ipynb_checkpoints
│              
├─smallatc                                                    // instances example in report
│  ├─test
│  │      
│  ├─train
│  │      
│  └─validation
│          
└─__pycache__
        

```
